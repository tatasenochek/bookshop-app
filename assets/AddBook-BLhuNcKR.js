import{s as y,R as f,j as e,I as N,g as E,r as U,B as w}from"./index-KX7zggbE.js";import{toast as l}from"./toastify-A_MKaA2v.js";import{B as M}from"./redux-CV9yM8-D.js";import{u as O,s as A,B as I}from"./types-Ci03CboM.js";import{u as L,a as R}from"./bookMutations-ClcgoyPW.js";import{c as v}from"./ui-Dr2rXh7g.js";import{e as F,u as V,a as $}from"./react-CXAtwWnn.js";import"./supabase-zNuR1CAo.js";const C="_form_me0ib_11",D="_label_me0ib_18",H="_text_me0ib_23",K="_select_me0ib_26",P="_error_me0ib_38",T="_textarea_me0ib_43",r={"add-book":"_add-book_me0ib_4",form:C,label:D,text:H,select:K,"select--error":"_select--error_me0ib_35",error:P,textarea:T};function Z(){var p,h,k,j;const n=F(),{state:c}=V(),m=M(y),s=c==null?void 0:c.book,[_,{isLoading:d}]=L(),[x,{isLoading:b}]=R(),{register:i,handleSubmit:B,formState:{errors:t,isValid:g}}=O({resolver:A(I),mode:"all",defaultValues:s?{book_name:s.book_name,book_author:s.book_author,genre:s.genre,description:s.description||"",rating:s.rating}:{genre:"",rating:""}}),S=$.useCallback(async a=>{if(!m){l.error("Необходимо авторизоваться");return}try{s?(await x({id:s.book_id,updates:{book_name:a.book_name,book_author:a.book_author,genre:a.genre,description:a.description,rating:a.rating}}).unwrap(),l.success("Книга успешно обновлена!"),n(`${f.BOOK}/${s.book_id}`)):(await _({bookData:{...a,user_id:m}}).unwrap(),l.success("Книга успешно добавлена!"),n(f.HOME))}catch(o){let u;typeof o=="object"&&o!==null&&"data"in o?u=o.data:o instanceof Error&&(u=o.message),console.error(u),l.error("Ошибка в процессе отправки данных")}},[_,s,n,x,m]);return e.jsx("div",{className:r["add-book"],children:d||b?e.jsx("p",{children:"Отправляем данные.."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:s?"Редактировать":"Добавить книгу"}),e.jsxs("form",{className:r.form,onSubmit:B(S),children:[e.jsx(N,{label:"Название книги","aria-label":"Название книги",...i("book_name"),error:(p=t.book_name)==null?void 0:p.message}),e.jsx(N,{label:"Автор книги","aria-label":"Автор книги",...i("book_author"),error:(h=t.book_author)==null?void 0:h.message}),e.jsxs("label",{className:r.label,children:[e.jsx("p",{className:r.text,children:"Жанр книги"}),e.jsx("select",{className:v(r.select,t.genre&&r["select--error"]),"aria-label":"Жанр книги",...i("genre"),children:E.map((a,o)=>e.jsx("option",{value:a.value,children:a.genre},o))}),t.genre&&e.jsx("span",{className:r.error,"aria-live":"assertive",children:(k=t.genre)==null?void 0:k.message})]}),e.jsxs("label",{className:r.label,children:[e.jsx("p",{className:r.text,children:"Мнение о книге или описание"}),e.jsx("textarea",{"aria-label":"Описание книги",className:r.textarea,...i("description")})]}),e.jsxs("label",{className:r.label,children:[e.jsx("p",{className:r.text,children:"Оценить книгу"}),e.jsx("select",{"aria-label":"Рейтинг книги",className:v(r.select,t.genre&&r["select--error"]),...i("rating"),children:U.map((a,o)=>e.jsx("option",{value:a.value,children:a.rating},o))}),t.rating&&e.jsx("span",{className:r.error,"aria-live":"assertive",children:(j=t.rating)==null?void 0:j.message})]}),e.jsx(w,{isPrimary:!0,disabled:!g||d||b,title:g?void 0:"Заполните все поля правильно",children:d||b?"Сохранение...":s?"Сохранить изменения":"Добавить книгу"})]})]})})}export{Z as default};
